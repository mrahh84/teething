{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0">{{ page_title }}</h1>
                <a href="{% url 'async_report_generation' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Report Generation
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-info-circle"></i> Report Status
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Report ID:</strong>
                            <code>{{ report_id }}</code>
                        </div>
                        <div class="col-md-6">
                            <strong>Status:</strong>
                            {% if status.status == 'ready' %}
                                <span class="badge badge-success">Ready</span>
                            {% elif status.status == 'processing' %}
                                <span class="badge badge-warning">Processing</span>
                            {% elif status.status == 'queued' %}
                                <span class="badge badge-info">Queued</span>
                            {% else %}
                                <span class="badge badge-secondary">{{ status.status|title }}</span>
                            {% endif %}
                        </div>
                    </div>

                    {% if status.status == 'ready' %}
                        <div class="alert alert-success mt-3">
                            <h6><i class="fas fa-check-circle"></i> Report Ready!</h6>
                            <p class="mb-0">Your report has been generated successfully and is ready for download.</p>
                        </div>
                        
                        <div class="mt-3">
                            <a href="{% url 'async_report_download' report_id=report_id %}" 
                               class="btn btn-primary">
                                <i class="fas fa-eye"></i> View Report
                            </a>
                            <a href="{% url 'async_report_download' report_id=report_id %}?format=csv" 
                               class="btn btn-success">
                                <i class="fas fa-download"></i> Download CSV
                            </a>
                            <a href="{% url 'async_report_download' report_id=report_id %}?format=json" 
                               class="btn btn-info">
                                <i class="fas fa-code"></i> Download JSON
                            </a>
                        </div>
                        
                        {% if status.completed_at %}
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-clock"></i> Completed at: {{ status.completed_at|date:"M d, Y H:i:s" }}
                            </small>
                        </div>
                        {% endif %}
                        
                    {% elif status.status == 'processing' %}
                        <div class="alert alert-warning mt-3">
                            <h6><i class="fas fa-cog fa-spin"></i> Processing Report</h6>
                            <p class="mb-0">Your report is currently being generated. This may take a few minutes.</p>
                        </div>
                        
                        {% if status.started_at %}
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-play"></i> Started at: {{ status.started_at|date:"M d, Y H:i:s" }}
                            </small>
                        </div>
                        {% endif %}
                        
                        <div class="mt-3">
                            <button class="btn btn-primary" onclick="location.reload()">
                                <i class="fas fa-sync-alt"></i> Refresh Status
                            </button>
                        </div>
                        
                    {% elif status.status == 'queued' %}
                        <div class="alert alert-info mt-3">
                            <h6><i class="fas fa-clock"></i> Report Queued</h6>
                            <p class="mb-0">Your report has been added to the queue and will be processed soon.</p>
                        </div>
                        
                        {% if status.position %}
                        <div class="mt-3">
                            <strong>Queue Position:</strong> {{ status.position }}
                        </div>
                        {% endif %}
                        
                        {% if status.queued_at %}
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-clock"></i> Queued at: {{ status.queued_at|date:"M d, Y H:i:s" }}
                            </small>
                        </div>
                        {% endif %}
                        
                        <div class="mt-3">
                            <button class="btn btn-primary" onclick="location.reload()">
                                <i class="fas fa-sync-alt"></i> Check Status
                            </button>
                        </div>
                        
                    {% else %}
                        <div class="alert alert-secondary mt-3">
                            <h6><i class="fas fa-question-circle"></i> Unknown Status</h6>
                            <p class="mb-0">Unable to determine the status of this report.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Status Information -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-info-circle"></i> Status Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6>Report Statuses:</h6>
                        <ul class="list-unstyled">
                            <li><span class="badge badge-info">Queued</span> - Waiting in line</li>
                            <li><span class="badge badge-warning">Processing</span> - Being generated</li>
                            <li><span class="badge badge-success">Ready</span> - Available for download</li>
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <h6>Download Formats:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-eye text-primary"></i> HTML - View online</li>
                            <li><i class="fas fa-file-csv text-success"></i> CSV - Excel compatible</li>
                            <li><i class="fas fa-file-code text-info"></i> JSON - API format</li>
                        </ul>
                    </div>
                    
                    <div class="alert alert-light">
                        <small>
                            <i class="fas fa-lightbulb"></i> 
                            <strong>Tip:</strong> You can bookmark this page to check status later.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-refresh status every 30 seconds if processing or queued
{% if status.status == 'processing' or status.status == 'queued' %}
setTimeout(function() {
    location.reload();
}, 30000);
{% endif %}
</script>
{% endblock %}
