{% extends "attendance/base.html" %}

{% block attendance_content %}
<div class="attendance-card">
    <div class="card-header">
        <h2>Bulk Attendance Entry</h2>
        <p style="margin: 0; color: #6c757d;">Enter attendance for all employees on a specific date</p>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            
            <div class="form-section">
                <h3>Date Selection</h3>
                <div class="field-group">
                    <div>
                        <label for="{{ form.date.id_for_label }}">{{ form.date.label }}</label>
                        {{ form.date }}
                        {% if form.date.errors %}
                            <div class="text-danger">{{ form.date.errors }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.date.help_text }}</small>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>Employee Attendance</h3>
                <p style="color: #6c757d; margin-bottom: 20px;">
                    Fill in the attendance details for each employee. Leave fields blank if no data is available.
                </p>
                
                {% for field_name, field in form.fields.items %}
                    {% if field_name != 'date' %}
                        {% with employee_id=field_name|slice:"-1:" %}
                            {% for employee in form.employee.queryset %}
                                {% if employee.id == employee_id|add:"0" %}
                                    <div class="employee-row">
                                        <div class="employee-name">{{ employee.surname }}, {{ employee.given_name }}</div>
                                        
                                        <div class="field-group">
                                            <div>
                                                <label for="{{ form.standup_employee_id.id_for_label }}">Stand-up</label>
                                                <select name="standup_{{ employee.id }}" class="form-select">
                                                    <option value="">---------</option>
                                                    <option value="YES">Yes</option>
                                                    <option value="NO">No</option>
                                                    <option value="ABSENT">Absent</option>
                                                    <option value="LATE">Late</option>
                                                    <option value="APPOINTMENT">Appointment</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="{{ form.lunch_time_employee_id.id_for_label }}">Lunch Time</label>
                                                <input type="time" name="lunch_time_{{ employee.id }}" class="form-control">
                                            </div>
                                            <div>
                                                <label for="{{ form.left_lunch_employee_id.id_for_label }}">Left Lunch On Time</label>
                                                <select name="left_lunch_{{ employee.id }}" class="form-select">
                                                    <option value="">---------</option>
                                                    <option value="YES">Yes</option>
                                                    <option value="NO">No</option>
                                                    <option value="ABSENT">Absent</option>
                                                    <option value="LATE">Late</option>
                                                    <option value="APPOINTMENT">Appointment</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="field-group">
                                            <div>
                                                <label for="{{ form.returned_on_time_employee_id.id_for_label }}">Returned On Time</label>
                                                <select name="returned_on_time_{{ employee.id }}" class="form-select">
                                                    <option value="">---------</option>
                                                    <option value="YES">Yes</option>
                                                    <option value="NO">No</option>
                                                    <option value="ABSENT">Absent</option>
                                                    <option value="LATE">Late</option>
                                                    <option value="APPOINTMENT">Appointment</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="{{ form.returned_after_employee_id.id_for_label }}">Returned After Lunch</label>
                                                <select name="returned_after_{{ employee.id }}" class="form-select">
                                                    <option value="">---------</option>
                                                    <option value="YES">Yes</option>
                                                    <option value="NO">No</option>
                                                    <option value="ABSENT">Absent</option>
                                                    <option value="LATE">Late</option>
                                                    <option value="APPOINTMENT">Appointment</option>
                                                </select>
                                            </div>
                                            <div>
                                                <div class="alert alert-info" style="margin: 0; padding: 8px; font-size: 0.9em;">
                                                    <strong>Note:</strong> Departure time will be pulled from clock-in system
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endwith %}
                    {% endif %}
                {% endfor %}
            </div>

            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}

            <div style="text-align: right; margin-top: 30px;">
                <a href="{% url 'attendance_list' %}" class="btn" style="margin-right: 10px;">Cancel</a>
                <button type="submit" class="btn btn-primary">Save All Records</button>
            </div>
        </form>
    </div>
</div>

<script>
// Auto-fill current date if not set
document.addEventListener('DOMContentLoaded', function() {
    const dateField = document.querySelector('input[name="date"]');
    if (dateField && !dateField.value) {
        const today = new Date().toISOString().split('T')[0];
        dateField.value = today;
    }
});
</script>
{% endblock %} 